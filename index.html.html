<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Master Dashboard - Mouse & Gesture</title>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>

<style>
  body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; }
  #container { position: relative; width: 100vw; height: 100vh; }
  video { display: none; }
  canvas { position: absolute; width: 100%; height: 100%; transform: scaleX(-1); }
  #paint_canvas { z-index: 5; }

  /* Floating UI Panels */
  .overlay { position: absolute; z-index: 10; }
  #top-ui { top: 15px; left: 15px; right: 15px; display: flex; justify-content: space-between; pointer-events: none; }
  
  .box { background: rgba(0,0,0,0.6); padding: 8px 15px; border-radius: 10px; border: 1px solid rgba(0,255,162,0.3); backdrop-filter: blur(10px); text-align: center; min-width: 80px; pointer-events: auto; }
  .label { font-size: 9px; color: #888; text-transform: uppercase; }
  .val { font-size: 24px; font-weight: bold; color: #00ffa2; }

  /* Side Control Panel (Mouse) */
  #side-panel { left: 15px; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 10px; }
  .color-btn { width: 45px; height: 45px; border-radius: 50%; border: 3px solid transparent; cursor: pointer; transition: 0.3s; }
  .color-btn:hover { transform: scale(1.1); }
  .active-c { border-color: #fff; box-shadow: 0 0 10px rgba(255,255,255,0.5); }

  /* Action Buttons */
  .action-btn { 
    padding: 12px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; 
    transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  #game-btn { background: #ffff00; color: #000; }
  #ss-btn { background: #00d4ff; color: #000; margin-top: 10px; }

  /* Game Target */
  #target { 
    position: absolute; width: 50px; height: 50px; background: radial-gradient(circle, #ff3366, #800020); 
    border-radius: 50%; border: 2px solid #fff; box-shadow: 0 0 20px #ff3366; display: none; z-index: 8; 
  }
</style>
</head>

<body>

  <div id="container">
    <div id="target"></div>
    <video id="input_video"></video>
    <canvas id="bg_canvas"></canvas>
    <canvas id="paint_canvas"></canvas>

    <div id="top-ui" class="overlay">
      <div class="box">
        <div class="label">FPS</div>
        <div class="val" id="fps-val" style="color: #00d4ff;">0</div>
      </div>
      <div class="box" style="border-color: #ffff00;">
        <div class="label" style="color:#ffff00;">Game Score</div>
        <div class="val" id="score-val" style="color:#fff;">0</div>
      </div>
      <div class="box">
        <div class="label">Fingers</div>
        <div class="val" id="count-val">0</div>
      </div>
    </div>

    <div id="side-panel" class="overlay">
      <div style="font-size: 10px; color: #aaa; text-align: center;">COLORS</div>
      <div class="color-btn active-c" onclick="setInk('#00ffa2', this)" style="background: #00ffa2;"></div>
      <div class="color-btn" onclick="setInk('#ff3366', this)" style="background: #ff3366;"></div>
      <div class="color-btn" onclick="setInk('#00d4ff', this)" style="background: #00d4ff;"></div>
      <div class="color-btn" onclick="setInk('#ffff00', this)" style="background: #ffff00;"></div>
      
      <hr style="width: 100%; border: 0.5px solid #444;">
      <button id="game-btn" class="action-btn" onclick="toggleGame()">START GAME</button>
      <button id="ss-btn" class="action-btn" onclick="takeScreenshot()">üì∏ SS</button>
      <button class="action-btn" style="background: #ff4d4d; color: #fff;" onclick="clearArt()">üóëÔ∏è CLEAR</button>
    </div>
  </div>

<script>
const videoElement = document.getElementById('input_video');
const canvasBg = document.getElementById('bg_canvas');
const ctxBg = canvasBg.getContext('2d');
const canvasPaint = document.getElementById('paint_canvas');
const ctxPaint = canvasPaint.getContext('2d');
const target = document.getElementById('target');
const fpsDisplay = document.getElementById('fps-val');

let isGame = false, penColor = "#00ffa2", score = 0, lastX = 0, lastY = 0;
let lastTime = 0, startTime = Date.now();

function resize() {
    canvasBg.width = canvasPaint.width = window.innerWidth;
    canvasBg.height = canvasPaint.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

function speak(t) {
    window.speechSynthesis.cancel();
    const m = new SpeechSynthesisUtterance(t);
    m.rate = 1.8;
    window.speechSynthesis.speak(m);
}

// Mouse Color Set
function setInk(color, el) {
    penColor = color;
    document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active-c'));
    el.classList.add('active-c');
    speak("Color Changed");
}

function clearArt() { ctxPaint.clearRect(0,0,canvasPaint.width, canvasPaint.height); }

function toggleGame() {
    isGame = !isGame;
    target.style.display = isGame ? 'block' : 'none';
    const btn = document.getElementById('game-btn');
    btn.innerText = isGame ? "STOP GAME" : "START GAME";
    btn.style.background = isGame ? "#ff4d4d" : "#ffff00";
    btn.style.color = isGame ? "#fff" : "#000";
    if(isGame) moveTarget();
    speak(isGame ? "Game On" : "Game Off");
}

function moveTarget() {
    const safeHeight = window.innerHeight * 0.7;
    target.style.left = Math.random() * (window.innerWidth - 80) + "px";
    target.style.top = Math.random() * (safeHeight - 80) + "px";
}

function takeScreenshot() {
    const ssCanvas = document.createElement('canvas');
    ssCanvas.width = canvasPaint.width; ssCanvas.height = canvasPaint.height;
    const sCtx = ssCanvas.getContext('2d');
    sCtx.save();
    sCtx.translate(ssCanvas.width, 0); sCtx.scale(-1, 1);
    sCtx.drawImage(canvasBg, 0, 0); sCtx.drawImage(canvasPaint, 0, 0);
    sCtx.restore();
    const link = document.createElement('a');
    link.download = 'AI_Master_Art.png'; link.href = ssCanvas.toDataURL();
    link.click();
    speak("Screenshot Saved");
}

function onResults(results) {
  // FPS Logic
  const now = performance.now();
  if (lastTime > 0) {
      fpsDisplay.innerText = Math.round(1000 / (now - lastTime));
  }
  lastTime = now;

  ctxBg.save();
  ctxBg.clearRect(0, 0, canvasBg.width, canvasBg.height);
  ctxBg.drawImage(results.image, 0, 0, canvasBg.width, canvasBg.height);

  if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
    const landmarks = results.multiHandLandmarks[0];
    const handType = results.multiHandedness[0].label;
    
    let count = 0;
    const isRight = handType === 'Right';
    if (isRight ? landmarks[4].x < landmarks[2].x : landmarks[4].x > landmarks[2].x) count++;
    [8, 12, 16, 20].forEach(i => { if(landmarks[i].y < landmarks[i-2].y) count++; });
    document.getElementById('count-val').innerText = count;

    const ix = landmarks[8].x * canvasPaint.width;
    const iy = landmarks[8].y * canvasPaint.height;

    if (isGame) {
        const mx = (1 - landmarks[8].x) * canvasPaint.width;
        const tx = target.offsetLeft + 25;
        const ty = target.offsetTop + 25;
        if(Math.hypot(mx - tx, iy - ty) < 40) {
            score++;
            document.getElementById('score-val').innerText = score;
            moveTarget();
            speak("Point");
        }
    } else {
        if (count === 1) {
            ctxPaint.strokeStyle = penColor;
            ctxPaint.lineWidth = 10;
            ctxPaint.lineCap = "round";
            if (lastX !== 0) {
                ctxPaint.beginPath(); ctxPaint.moveTo(lastX, lastY);
                ctxPaint.lineTo(ix, iy); ctxPaint.stroke();
            }
            lastX = ix; lastY = iy;
        } else { lastX = 0; lastY = 0; }
        if (count === 5) clearArt();
    }
    drawConnectors(ctxBg, landmarks, HAND_CONNECTIONS, {color: '#ffffff33', lineWidth: 1});
  } else { lastX = 0; lastY = 0; }
  ctxBg.restore();
}

const hands = new Hands({ locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}` });
hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.8, minTrackingConfidence: 0.8 });
hands.onResults(onResults);

const camera = new Camera(videoElement, {
  onFrame: async () => { await hands.send({image: videoElement}); },
  width: 1280, height: 720
});
camera.start();
</script>
</body>
</html>
